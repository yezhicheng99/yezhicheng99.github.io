---
title: 针孔相机模型及相机内参学习笔记
date: 2022-08-10 22:23:50
categories:
tags: ["相机标定"]
top_img:
---

相机模型描述的是三维空间中的坐标点到二维图像上的对应点的映射过程。针孔相机是最简单和常用的相机模型，被广泛应用到工业和科研领域。而相机的内参是相机成像模型中最关键的参数，它通常包括光线的投影过程及畸变过程。

## 针孔相机模型
针孔相机模型实际上就是中学课堂上讲的蜡烛投影成像的过程。下图表示针孔相机模型成像过程。

<img src="针孔相机模型.PNG" width="70%" height="70%" />

设空间中一点 $P$ 在相机坐标系 $O-x-y-z$ 下的三维坐标是 $[X, Y, Z]^T$, 改点在成像平面表示的坐标系下 $O^{'}-x^{'}-y^{'}-z^{'}$ 下的坐标为 $[X^{'}, Y^{'}, X^{'}]^{T}$,根据相似三角形关系，得到如下关系：

$$
\frac{Z}{f}=-\frac{X}{X^{'}}=-\frac{Y}{Y^{'}}
$$

为了方便，将成像平面移到物体同一侧：

$$
\frac{Z}{f}=\frac{X}{X^{'}}=\frac{Y}{Y^{'}}
$$

整理得：

$$
\begin{matrix}
X^{'}=f\frac{X}{Z}\\
Y^{'}=f\frac{Y}{Z}
\end{matrix}
$$
 
假设成像点在图像上的像素坐标为：$[u, v]^{T}$, 得到以下对应关系：

$$
\left\{ 
\begin{matrix}
u = \alpha X^{'} + c_{x} = \alpha f\frac{X}{Z} + c_{x} = f_{x}\frac{X}{Z} + c_{x} \\
v = \beta Y^{'} + c_{y} = \beta f\frac{Y}{Z} + c_{y} = f_{y}\frac{Y}{Z} + c_{y} \\
\end{matrix}
\right.
$$

其中，$\alpha$ 和 $\beta$ 分别表示点在 $x$ 和 $y$ 轴上的缩放系数，单位是像素 $/$ 米，$c_{x}$ 和 $c_{y}$ 分别表示从图像中心点到图像左上角的像素平移量，单位是像素，$f_{x} = \alpha f$ 以及 $f_{y} = \beta f$ 。

以上方程写成矩阵形式：

$$
\begin{bmatrix}u\\v\\1\end{bmatrix} = \frac{1}{Z}  \begin{bmatrix}f_{x}&0&c_{x}\\0&f_{y}&c_{y}\\0&0&1\end{bmatrix}  \begin{bmatrix}X\\Y\\Z\end{bmatrix} = \frac{1}{Z} K P_{c}
$$

其中矩阵 $K$ 即是相机的内参数矩阵。

上式中 $P$ 点为空间点在相机坐标系下的坐标，所以如果点的坐标为世界坐标系下的坐标，需要根据当前相机位姿将其转换到相机坐标系下：

$$
P_{c} = TP_{w} = RP_{w} + t
$$

## 畸变模型
畸变模型分为径向畸变和切向畸变。

径向畸变：由于透镜自身的形状引起的，表现为空间中的直线在图像中变成了曲线，越接近图像边缘，径向畸变越明显，如图：

<img src="径向畸变.webp" width="80%" height="80%" />

<img src="径向畸变原因.webp" width="60%" height="60%" />


切向畸变：由于安装过程中透镜和成像平面没有绝对平行所造成的。表现为原本平行的两条直线，在图像中变得不平行，如图：

<img src="切向畸变.webp" width="80%" height="80%" />

<img src="切向畸变原因.webp" width="80%" height="80%" />

假设归一化平面上（相机坐标系下 $Z=1$ 处平面）一点 $P$ 畸变前坐标为：$[x, y]^{T}$，$r= \sqrt{x^{2}+y^{2}} $ 表示点 $P$ 距离归一化平面坐标原点的距离。

径向畸变方程表示：

$$
\begin{matrix}
x_{distorted}=x(1+K_{1}r^{2}+K_{2}r^{4}+K_{3}r^{6}) \\
y_{distorted}=y(1+K_{1}r^{2}+K_{2}r^{4}+K_{3}r^{6})
\end{matrix}
$$

切向畸变方程表示：

$$
\begin{matrix}
x_{distored}=x+2p_{1}xy+p_{2}(r^{2}+2x^{2}) \\
y_{distored}=y+p_{1}(r^{2}+2y^{2})+2 p_{2}xy
\end{matrix}
$$

结合后总的畸变方程为：
$$
\begin{matrix}
x_{distorted}=x(1+K_{1}r^{2}+K_{2}r^{4}+K_{3}r^{6})+2p_{1}xy+p_{2}(r^{2}+2x^{2})\\
y_{distorted}=y(1+K_{1}r^{2}+K_{2}r^{4}+K_{3}r^{6})+p_{1}(r^{2}+2y^{2})+2 p_{2}xy
\end{matrix}
$$

投影到像素平面：
$$
\left \{
 \begin{matrix}u=f_{x}x_{distorted}+c_{x}\\v=f_{y}y_{distorted}+c_{y}\end{matrix}
\right.
$$

总结：
- 畸变参数一般有5个：$k_{1}, k_{2}, k_{3}, p_{1}, p_{2}$
- 涉及到的坐标系：世界坐标，相机坐标，相机归一化坐标，成像坐标，像素坐标
- 坐标系变换过程：
<img src="坐标变换过程.PNG" width="70%" height="70%" />


